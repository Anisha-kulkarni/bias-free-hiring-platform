<%- include('partials/header') %>

    <!-- Dashboard Hero Area -->
    <div class="dashboard-header" style="
        padding: 4rem 0 2rem; 
        background: radial-gradient(circle at top right, rgba(124, 58, 237, 0.1), transparent 40%);
        border-bottom: 1px solid rgba(255,255,255,0.05);
    ">
        <div class="container">
            <div
                style="display: flex; justify-content: space-between; align-items: flex-end; flex-wrap: wrap; gap: 2rem;">
                <div>
                    <p
                        style="text-transform: uppercase; letter-spacing: 2px; font-size: 0.8rem; color: var(--color-accent); margin-bottom: 0.5rem; animation: fadeIn 0.5s;">
                        Adaptive Learning Dashboard</p>
                    <h1 style="margin-bottom: 0.5rem; font-size: 3rem; animation: fadeIn 0.5s 0.1s backwards;">
                        Hello, <span
                            style="background: linear-gradient(135deg, white, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                            <%= user.name %>
                        </span>
                    </h1>
                    <p style="color: var(--color-text-muted); animation: fadeIn 0.5s 0.2s backwards;">
                        Your specialized <strong style="color: white; text-transform: capitalize;">
                            <%= user.preferences.learningStyle %>
                        </strong> path is ready.
                    </p>
                </div>

                <!-- Feature: Mood Check-in -->
                <div class="card mood-checkin"
                    style="padding: 1rem 1.5rem; display: flex; flex-direction: column; gap: 0.5rem; animation: fadeIn 0.5s 0.3s backwards; min-width: 250px;">
                    <span style="font-size: 0.8rem; color: var(--color-text-muted); text-transform: uppercase;">How are
                        you feeling today?</span>
                    <div style="display: flex; gap: 1rem; font-size: 1.5rem;">
                        <button onclick="setMood('energized')" class="mood-btn" title="Energized"
                            style="background:none; border:none; cursor:pointer; transition: transform 0.2s;">üöÄ</button>
                        <button onclick="setMood('calm')" class="mood-btn" title="Calm"
                            style="background:none; border:none; cursor:pointer; transition: transform 0.2s;">üßò‚Äç‚ôÇÔ∏è</button>
                        <button onclick="setMood('tired')" class="mood-btn" title="Tired"
                            style="background:none; border:none; cursor:pointer; transition: transform 0.2s;">üò¥</button>
                        <button onclick="setMood('curious')" class="mood-btn" title="Curious"
                            style="background:none; border:none; cursor:pointer; transition: transform 0.2s;">ü§î</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container" style="margin-top: 3rem; display: grid; grid-template-columns: 2fr 1fr; gap: 3rem;">

        <!-- Left Column: Learning Journey Timeline -->
        <div class="main-content">
            <h2 style="margin-bottom: 2rem; display: flex; align-items: center; gap: 1rem;">
                <span>üó∫Ô∏è Learning Journey</span>
                <span
                    style="font-size: 0.8rem; background: var(--glass-bg); padding: 4px 12px; border-radius: 20px; border: var(--glass-border); font-weight: normal; color: var(--color-text-muted);">Steps:
                    <%= path ? path.length : 0 %>
                </span>
            </h2>

            <div class="timeline"
                style="position: relative; padding-left: 2rem; border-left: 2px solid rgba(255,255,255,0.05);">
                <% if (path && path.length> 0) { %>
                    <% path.forEach((unit, index)=> { %>
                        <div class="unit-card timeline-item" style="margin-bottom: 2rem; position: relative;">
                            <!-- Connector Dot -->
                            <div style="
                            position: absolute; 
                            left: -2.6rem; 
                            top: 2rem; 
                            width: 16px; 
                            height: 16px; 
                            border-radius: 50%; 
                            background: var(--color-primary); 
                            border: 4px solid var(--color-bg-deep);
                            box-shadow: 0 0 10px var(--color-primary-glow);
                        "></div>

                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div
                                        style="display: flex; gap: 0.8rem; margin-bottom: 0.5rem; align-items: center;">
                                        <span
                                            style="color: var(--color-accent); font-weight: 700; font-size: 0.9rem;">MODULE
                                            0<%= index + 1 %></span>
                                        <span
                                            style="font-size: 0.8rem; padding: 2px 8px; border-radius: 4px; background: rgba(255,255,255,0.1); color: var(--color-text-muted);">
                                            <%= unit.type %>
                                        </span>
                                        <% if(unit.score) { %>
                                            <span style="font-size: 0.8rem; color: #34d399;">Match: <%= unit.score %>
                                            </span>
                                            <% } %>
                                    </div>
                                    <h3 style="margin: 0; font-size: 1.4rem; margin-bottom: 0.5rem;">
                                        <%= unit.title %>
                                    </h3>
                                    <p
                                        style="color: var(--color-text-muted); font-size: 0.95rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                        Click to begin your personalized session on this topic.
                                    </p>
                                </div>

                                <a href="/unit/<%= unit.id %>" class="btn" style="min-width: 100px;">
                                    Start &rarr;
                                </a>
                            </div>
                        </div>
                        <% }) %>
                            <% } else { %>
                                <p>No learning path generated yet.</p>
                                <% } %>
            </div>
        </div>

        <!-- Right Column: Stats & Tools -->
        <div class="sidebar">
            <!-- Feature: Google Search Widget -->
            <div class="card" style="margin-bottom: 2rem;">
                <h3 style="font-size: 1.2rem; margin-bottom: 1rem;">üîç Quick Search</h3>
                <form action="https://www.google.com/search" method="GET" target="_blank"
                    style="display: flex; gap: 0.5rem;">
                    <input type="text" name="q" placeholder="Search Google..." style="
                        flex: 1;
                        padding: 0.6rem;
                        border-radius: 4px;
                        border: 1px solid rgba(255,255,255,0.1);
                        background: rgba(0,0,0,0.2);
                        color: white;
                        outline: none;
                    ">
                    <button type="submit" class="btn"
                        style="padding: 0.6rem; background: var(--color-primary);">Go</button>
                </form>
            </div>

            <!-- Feature: Skill Mastery Rings -->
            <div class="card" style="margin-bottom: 2rem;">
                <h3 style="font-size: 1.2rem; margin-bottom: 1.5rem;">üß† Skill Mastery</h3>
                <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 1rem;">

                    <% const safeStats=(typeof stats !=='undefined' && stats) ? stats : { algebra: 0, geometry: 0 }; %>

                        <!-- Mastery Item 1 -->
                        <div style="text-align: center;">
                            <div class="progress-ring" data-percent="<%= safeStats.algebra %>"
                                style="width: 80px; height: 80px; position: relative; margin: 0 auto 0.5rem;">
                                <svg width="80" height="80">
                                    <circle cx="40" cy="40" r="36" stroke="rgba(255,255,255,0.1)" stroke-width="6"
                                        fill="transparent" />
                                    <circle cx="40" cy="40" r="36" stroke="#c084fc" stroke-width="6" fill="transparent"
                                        stroke-dasharray="226"
                                        stroke-dashoffset="<%= 226 - (226 * safeStats.algebra / 100) %>"
                                        style="transition: stroke-dashoffset 1s ease; transform: rotate(-90deg); transform-origin: 50% 50%;" />
                                </svg>
                                <div
                                    style="position: absolute; top:0; left:0; width:100%; height:100%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9rem;">
                                    <%= safeStats.algebra %>%
                                </div>
                            </div>
                            <span style="font-size: 0.8rem; color: var(--color-text-muted);">Algebra</span>
                        </div>

                        <!-- Mastery Item 2 -->
                        <div style="text-align: center;">
                            <div class="progress-ring" data-percent="<%= safeStats.geometry %>"
                                style="width: 80px; height: 80px; position: relative; margin: 0 auto 0.5rem;">
                                <svg width="80" height="80">
                                    <circle cx="40" cy="40" r="36" stroke="rgba(255,255,255,0.1)" stroke-width="6"
                                        fill="transparent" />
                                    <circle cx="40" cy="40" r="36" stroke="#22d3ee" stroke-width="6" fill="transparent"
                                        stroke-dasharray="226"
                                        stroke-dashoffset="<%= 226 - (226 * safeStats.geometry / 100) %>"
                                        style="transition: stroke-dashoffset 1s ease; transform: rotate(-90deg); transform-origin: 50% 50%;" />
                                </svg>
                                <div
                                    style="position: absolute; top:0; left:0; width:100%; height:100%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9rem;">
                                    <%= safeStats.geometry %>%
                                </div>
                            </div>
                            <span style="font-size: 0.8rem; color: var(--color-text-muted);">Geometry</span>
                        </div>
                </div>
            </div>

            <!-- Feature: Daily Goals (Drag and Drop Placeholder) -->
            <div class="card" style="margin-bottom: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="font-size: 1.2rem; margin: 0;">üéØ Today's Goals</h3>
                    <button
                        style="background: none; border: none; color: var(--color-primary); cursor: pointer; font-size: 1.2rem;">+</button>
                </div>

                <ul style="list-style: none; padding: 0;">
                    <li
                        style="display: flex; gap: 0.8rem; padding: 0.8rem; background: rgba(255,255,255,0.03); margin-bottom: 0.5rem; border-radius: 8px; align-items: center;">
                        <input type="checkbox"
                            style="accent-color: var(--color-primary); width: 1.2rem; height: 1.2rem;">
                        <span style="font-size: 0.95rem;">Complete 2 Physics Units</span>
                    </li>
                    <li
                        style="display: flex; gap: 0.8rem; padding: 0.8rem; background: rgba(255,255,255,0.03); margin-bottom: 0.5rem; border-radius: 8px; align-items: center;">
                        <input type="checkbox"
                            style="accent-color: var(--color-primary); width: 1.2rem; height: 1.2rem;">
                        <span style="font-size: 0.95rem;">Score >80% on Quiz</span>
                    </li>
                </ul>
            </div>

            <!-- Feature: Interactive Mentor Placeholder -->
            <div class="card"
                style="background: linear-gradient(135deg, rgba(124, 58, 237, 0.2), rgba(255,255,255,0.05)); border: 1px solid var(--color-primary-glow);">
                <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
                    <div style="font-size: 2rem;">ü§ñ</div>
                    <div>
                        <h4 style="margin: 0; color: white;">AI Mentor</h4>
                        <span style="font-size: 0.8rem; color: #34d399;">Online & Ready</span>
                    </div>
                </div>
                <p style="font-size: 0.9rem; color: #e2e8f0; margin-bottom: 1rem;">
                    "I noticed you're doing great in Algebra! Want to try a challenge question?"
                </p>
                <button class="btn" style="width: 100%; font-size: 0.9rem; padding: 0.5rem;">Accept Challenge</button>
            </div>
        </div>
    </div>

    <script>
        // Mood Check-in Interactions
        function setMood(mood) {
            const checkinCard = document.querySelector('.mood-checkin');
            let message = "";
            let color = "";

            switch (mood) {
                case 'energized':
                    message = "That's the spirit! Let's crush some goals! üöÄ";
                    color = "rgba(34, 197, 94, 0.2)";
                    break;
                case 'calm':
                    message = "Focus mode on. Smooth sailing ahead. üåä";
                    color = "rgba(56, 189, 248, 0.2)";
                    break;
                case 'tired':
                    message = "No worries, we'll keep it light today. ‚òï";
                    color = "rgba(168, 85, 247, 0.2)";
                    break;
                case 'curious':
                    message = "Love that! Let's explore something new. üîç";
                    color = "rgba(250, 204, 21, 0.2)";
                    break;
            }

            checkinCard.innerHTML = `<p style='text-align: center; margin: 0; animation: fadeIn 0.3s;'>${message}</p>`;
            checkinCard.style.background = color;
            checkinCard.style.borderColor = color.replace('0.2)', '0.5)');
        }

        // Grid Hover Effects
        document.querySelectorAll('.mood-btn').forEach(btn => {
            btn.addEventListener('mouseenter', () => btn.style.transform = 'scale(1.2)');
            btn.addEventListener('mouseleave', () => btn.style.transform = 'scale(1)');
        });
    </script>

    <%- include('partials/footer') %>